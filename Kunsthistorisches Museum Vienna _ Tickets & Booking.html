<!DOCTYPE html>
<!-- saved from url=(0077)file:///C:/Users/yuanhuaqing/website/Kunsthistorisches%20Museum%20Vienna.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kunsthistorisches Museum Vienna | Tickets &amp; Booking</title>
<meta name="description" content="Kunsthistorisches Museum Vienna ticket booking: opening hours, August 2026 calendar, time slots, prices, and tour guide options.">
<style>
/* Reset */
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; color: #1a1a1a; background: #fff; }
a { color: #0a66c2; text-decoration: none; }
a:hover { text-decoration: underline; }
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap');

/* Theme */
:root { --brand:#0a66c2; --brand-dark:#084c90; --accent:#d11f3d; --mint:#1fbdbd; --sand:#f7f4ee; --ink:#101418; --sky:#eaf3ff; --lav:#efe9ff; --leaf:#e6f7f2; }

/* Layout */
header { position: sticky; top: 0; z-index: 10; background: rgba(255,255,255,.9); backdrop-filter: saturate(180%) blur(8px); border-bottom: 1px solid #eee; }
.container { max-width: 1120px; padding: 0 16px; margin: 0 auto; }
.nav { display: flex; align-items: center; justify-content: space-between; height: 56px; }
.brand { font-weight: 700; letter-spacing: .3px; }
.nav a { margin-left: 16px; font-weight: 500; }

main section { padding: 48px 0; border-bottom: 1px solid #f3f3f3; }
section h2 { margin: 0 0 16px; font-size: 24px; }
section p { line-height: 1.75; margin: 0 0 12px; }

.section-alt { background: var(--sand); border-top: 1px solid #f0ece3; border-bottom: 1px solid #f0ece3; }
.section-accent { background: linear-gradient(180deg, #fff 0%, var(--leaf) 100%); }
.heading-accent { display: inline-flex; align-items: center; gap: 12px; font-family: 'Playfair Display', Georgia, serif; letter-spacing: .3px; }
.heading-accent::before { content:""; display:inline-block; width: 36px; height: 10px; border-radius: 6px; background: linear-gradient(90deg, #c58f1b 0%, #f1d18a 100%); box-shadow: 0 2px 8px rgba(197,143,27,.35); }
.heading-accent.center { justify-content: center; width: 100%; }
.subheading { font-size: 18px; font-weight: 700; color: #244b6b; margin: 0 0 12px; letter-spacing: .2px; }
.section-title { display:flex; align-items:center; gap:10px; font-weight:800; color: #7a4a17; }
.section-title .dot { width:12px; height:12px; background:#c36c19; border-radius:50%; display:inline-block; box-shadow: 0 0 0 3px #f7e6cf inset; }
.section-card { border:1px solid #eee; border-radius:14px; background:#fff; box-shadow: 0 10px 18px rgba(0,0,0,.05); padding: 16px; }
.section-card.fill { display:flex; flex-direction: column; height: 100%; }
/* Divider below panel header */
.panel-divider { height: 0; border: 0; border-top: 1px solid #edf0f3; margin: 8px 0 12px; }

.grid { display: grid; grid-template-columns: repeat(12, 1fr); grid-gap: 16px; }
.col-6 { grid-column: span 6; }
.col-7 { grid-column: span 7; }
.col-5 { grid-column: span 5; }
.col-12 { grid-column: span 12; }

@media (max-width: 768px) {
	.nav a { margin-left: 12px; }
	.grid { grid-template-columns: repeat(6, 1fr); }
	.col-6 { grid-column: span 6; }
	.col-7 { grid-column: span 6; }
	.col-5 { grid-column: span 6; }
}

/* Cards & media */
.card { border: 1px solid #eee; border-radius: 10px; overflow: hidden; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
.card .body { padding: 16px; }
img.responsive { display: block; width: 100%; height: auto; }
.card.accent { border-color: var(--sky); background: #fff; box-shadow: 0 6px 16px rgba(10,102,194,.08); }
.badge { display: inline-block; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; color: #fff; background: var(--brand); }
.badge.alt { background: var(--accent); }

/* Cover (full-bleed, keep aspect ratio) */
.cover { position: relative; border-bottom: 1px solid #eee; min-height: 160px; max-height: 30vh; overflow: hidden; }
.cover-inner { position: static; }
.cover .container { max-width: 100%; padding: 0; }
.cover img { width: 100%; height: 100%; display: block; object-fit: cover; object-position: center 60%; }
.cover .overlay { position: absolute; inset: 0; z-index: 1; background: linear-gradient(180deg, rgba(16,20,24,.15) 0%, rgba(10,102,194,.35) 70%, rgba(0,0,0,.45) 100%); display: flex; align-items: center; justify-content: center; text-align: center; }
.hero .content, .cover .content { color: #fff; padding: 12px 16px; width: 100%; max-width: 900px; margin: 0 auto; }
.hero .title, .cover .title { font-size: 34px; margin: 0 0 6px; font-family: Georgia, "Times New Roman", serif; letter-spacing: .5px; text-shadow: 0 2px 4px rgba(0,0,0,.5), 0 8px 24px rgba(0,0,0,.35); }
.hero .subtitle, .cover .subtitle { font-size: 16px; opacity: .95; margin: 0; text-shadow: 0 1px 2px rgba(0,0,0,.45); }

/* Footer */
footer { color: #666; padding: 24px 0; }

/* Final bottom summary */
.final-summary { padding: 20px 0 28px; background: #f8fafc; border-top: 1px solid #edf0f3; }
.final-summary .final-dt { text-align: center; color: #5b6b7a; margin-bottom: 8px; font-weight: 600; }
.final-summary .final-dt .sep { margin: 0 8px; color: #9aa6b2; }
.final-summary .final-divider { border-top: 1px solid #e6e9ee; margin: 8px 0 12px; }
.success-banner { display:none; margin: 10px auto 0; max-width: 760px; text-align:center; background:#e6f7f2; border:1px solid #c6efe2; color:#0a7f6d; padding: 12px 14px; border-radius: 12px; font-weight: 800; }
.final-summary .final-list { max-width: 760px; margin: 0 auto 10px; display: grid; gap: 8px; color: #2b3a4a; }
.final-summary .final-item { display:flex; align-items:center; justify-content:space-between; padding: 8px 10px; background:#fff; border:1px solid #edf0f3; border-radius:10px; }
.final-summary .final-item .label { font-weight: 700; }
.final-summary .final-item .value { font-weight: 800; color: #22313f; }
.total-banner { background: #22313f; color:#fff; font-weight:800; text-align:center; border-radius: 16px; padding: 16px; font-size: 20px; }
.final-cta { display:block; margin: 12px auto 0; background:#22313f; color:#fff; font-weight:800; border:0; border-radius:28px; padding: 12px 28px; box-shadow: 0 8px 22px rgba(34,49,63,.25); letter-spacing:.5px; }
.final-cta:disabled { filter: grayscale(1); opacity: .6; cursor: not-allowed; }
/* Simple modal */
/* (modal styles removed on revert) */

/* Utility */
.muted { color: #666; }
.btn { display: inline-block; padding: 10px 14px; border-radius: 8px; background: var(--brand); color: #fff; font-weight: 600; }
.btn:hover { filter: brightness(.95); text-decoration: none; }
.btn.alt { background: var(--accent); }
.pill-info { display:inline-flex; gap:8px; align-items:center; padding:8px 12px; background: var(--sky); border:1px solid #d9eaff; border-radius: 999px; }
/* Section notice */
.section-note { display:flex; align-items:center; justify-content:center; gap:10px; padding:10px 12px; background: var(--sky); border:1px solid #d9eaff; border-radius:12px; color:#244b6b; font-weight:700; margin: 8px 0 16px; }
.section-note.small { font-weight:600; padding:8px 10px; margin:6px 0 10px; }
.info-ic { width:18px; height:18px; border-radius:999px; border:1px solid #d9eaff; background: var(--sky); color: var(--brand); display:inline-flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; line-height:1; }
.info-ic.lg { width:22px; height:22px; font-size:14px; }

/* Hours redesign */
.hours-card { background: linear-gradient(180deg, #fafcfe 0%, #f3f7fb 100%); border:1px solid #e3ecf7; border-radius:14px; padding:16px; box-shadow: 0 8px 18px rgba(10,102,194,.06); }
.hours-list { list-style:none; padding:0; margin:0; }
.hours-list li { display:flex; justify-content:space-between; padding:10px 12px; border-bottom: 1px dashed #e3e8ef; }
.hours-list li:last-child { border-bottom:0; }
.hours-em { background:#ffe9e6; color:#9a1f0e; border:1px solid #ffd2c9; padding:2px 8px; border-radius:999px; font-weight:800; font-size:12px; }
.hours-note { font-size:13px; color:#5b6b7a; margin-top:8px; }
.address-card { background: linear-gradient(180deg, #fffdf7 0%, #fbf4e6 100%); border:1px solid #f0e1be; border-radius:14px; padding:16px; }
/* Horizontal hours blocks */
.hours-flex { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
.hour-box { padding:14px; border-radius:12px; border:1px solid #e3ecf7; background: linear-gradient(180deg, #f7fbff 0%, #edf5ff 100%); box-shadow: 0 6px 14px rgba(10,102,194,.06); }
.hour-box h4 { margin:0 0 6px; font-size:14px; color:#244b6b; text-transform: uppercase; letter-spacing:.4px; }
.hour-box p { margin:0; font-weight:700; }
.hour-box.em { background: linear-gradient(180deg, #fff0ec 0%, #ffe2db 100%); border-color:#ffd2c9; }
.hour-box.em h4 { color:#8b2a18; }
.fullbleed { width: 100vw; margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw); padding-left: 16px; padding-right: 16px; }

/* Booking blocks */
.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
.day { border: 1px solid #e6e6e6; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; user-select: none; background: #fafafa; font-weight: 700; }
.calendar .day:nth-child(odd):not(.disabled) { background: #f6fbff; }
.day:hover { background: #f0f7ff; }
.day.disabled { color: #bbb; background: #f8f8f8; cursor: not-allowed; text-decoration: line-through; }
.day.selected { outline: 3px solid var(--brand); background: #eaf3ff; }

/* Calendar visual tweaks */
.calendar-block { background: linear-gradient(180deg, #fbfdff 0%, #f5f9ff 100%); border: 1px solid #e3ecf7; border-radius: 14px; padding: 12px; box-shadow: 0 8px 18px rgba(10,102,194,.06); }
.calendar .day { display: flex; align-items: center; justify-content: center; padding: 0; aspect-ratio: 1 / 1; background: #fff; border-color: #e6edf7; transition: background .2s ease, border-color .2s ease, transform .05s ease; }
.calendar .day.header { border-radius: 8px; }
.calendar .day:not(.disabled):hover { background: #f0f7ff; border-color: var(--brand); transform: translateY(-1px); }
.calendar .day.selected { outline: 3px solid var(--brand); background: #eaf3ff; border-color: var(--brand); box-shadow: 0 6px 16px rgba(10,102,194,.12); }
.calendar .day:focus-visible { outline: 3px solid var(--brand); outline-offset: 2px; }

/* Calendar weekday header (distinct, darker tone) */
.calendar .day.header { text-decoration: none; cursor: default; pointer-events: none; color: #182430; background: linear-gradient(180deg, #c0d4ec 0%, #a8bfde 100%); font-weight: 800; text-transform: uppercase; letter-spacing: .5px; font-size: 12px; border-color: #99b1d6; }
/* Calendar month label */
.calendar-head { display:flex; align-items:center; justify-content:center; gap:8px; margin: 6px 0 10px; font-weight:800; color:#244b6b; }
.cal-btn { width:28px; height:28px; border:1px solid #e3ecf7; border-radius:8px; background:#fff; color:#244b6b; font-weight:800; line-height:1; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.cal-btn:hover { background:#eef3f9; }
.cal-btn:focus { outline: 2px solid var(--brand); outline-offset: 2px; }
.cal-btn:disabled { opacity: .5; cursor: not-allowed; filter: grayscale(1); }

.slots { display: flex; flex-wrap: wrap; gap: 8px; }
.slot { padding: 10px 12px; border: 1px solid #e6e6e6; border-radius: 10px; cursor: pointer; background: #fff; }
.slot.disabled { color: #bbb; background: #f8f8f8; cursor: not-allowed; text-decoration: line-through; }
.slot.selected { background: var(--accent); color: #fff; border-color: var(--accent); }
.slot-wrap { position: relative; }
.slot-wrap .soldout { position: absolute; top: -8px; right: -8px; background:#e14a4a; color:#fff; font-size:10px; padding:2px 6px; border-radius:999px; box-shadow:0 2px 6px rgba(0,0,0,.2); }

.tickets { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; column-gap: 12px; row-gap: 12px; align-items: start; }
.qty { display: inline-flex; align-items: center; border: 1px solid #e6e6e6; border-radius: 8px; overflow: hidden; }
.qty button { width: 40px; height: 40px; border: 0; background: #eef3f9; color:#244b6b; cursor: pointer; font-size: 18px; }
.qty input { width: 56px; border: 0; text-align: center; font-weight: 700; font-size: 16px; }
.price { font-weight: 800; font-size: 18px; color: var(--brand); }
.total { font-size: 20px; font-weight: 800; background: var(--sky); border:1px solid #d9eaff; color: var(--brand-dark); padding:8px 12px; border-radius:10px; }
/* Tickets area emphasis */
.tickets strong { font-size: 16px; color: #244b6b; }

/* Ticket list (row layout like screenshot) */
.ticket-list { display: grid; gap: 6px; }
.ticket-list.with-topline { border-top: 3px solid #d9eaff; padding-top: 6px; border-radius: 2px; }
.ticket-row { display: grid; grid-template-columns: 1fr auto auto auto auto; align-items: center; padding: 12px 8px; border-bottom: 1px solid #edf0f3; }
.ticket-row:last-child { border-bottom: 0; }
.ticket-title { display: grid; gap: 6px; }
.ticket-title strong { font-size: 16px; color: #182430; }
.ticket-subtitle { font-size: 13px; color: #6b7785; font-style: italic; display:inline-flex; align-items:center; gap:6px; }
.ticket-subtitle .info-ic { width:18px; height:18px; border-radius:999px; border:1px solid #d9eaff; background: var(--sky); color: var(--brand); display:inline-flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; line-height:1; }
/* Emphasis for tour duration */
.time-pill { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; background: var(--sky); border:1px solid #d9eaff; color: var(--brand-dark); border-radius:999px; font-weight:800; font-size:12px; }
/* Remaining pill for tours */
.remain-pill { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; background:#f6faff; border:1px solid #e3ecf7; color:#244b6b; border-radius:999px; font-weight:800; font-size:12px; }
.ticket-price { font-weight: 800; font-size: 18px; padding: 0 8px; }
.price-green { color: #3a6ea5; }
.price-free { color: #3a6ea5; font-weight: 900; }
.circle-btn { width: 36px; height: 36px; border-radius: 999px; border: 1px solid #e0e6ee; display: inline-flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }
.circle-btn.minus { background: #f3f6fb; color: #5e6f84; }
.circle-btn.plus { background: var(--sky); color: var(--brand); border-color: #d9eaff; }
.circle-btn.plus:hover { background: #dfefff; }
.circle-btn:disabled { opacity: .5; cursor: not-allowed; }
.ticket-qty { width: 28px; text-align: center; font-weight: 800; color: #2b3a4a; }
/* Tour rows align to ticket style */
.ticket-row.tour { grid-template-columns: auto 1fr auto auto auto auto; column-gap: 8px; }
.ticket-row.tour input[type="radio"] { transform: scale(1.05); accent-color: var(--brand); }

/* Sticky booking bar */
.booking-bar { position: sticky; bottom: 0; z-index: 15; background: #ffffffee; backdrop-filter: saturate(180%) blur(8px); border-top: 3px solid var(--brand); }
.booking-inner { display: grid; grid-template-columns: repeat(6, 1fr); grid-template-areas:
    'date time tickets tours audio button'
    'summary summary summary summary summary button';
  gap: 10px 12px; align-items: center; padding: 12px 16px; }
.booking-inner #pill-date, .booking-inner #pill-time, .booking-inner #pill-count, .booking-inner #pill-tours, .booking-inner #pill-audio, .booking-inner #summary { display: none; }
.booking-inner #pill-date { grid-area: date; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-time { grid-area: time; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-count { grid-area: tickets; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-tours { grid-area: tours; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-audio { grid-area: audio; background: #fff; border-color: #e6e6e6; }
.booking-inner #summary { grid-area: summary; }
/* total pill removed from layout as requested */
.booking-inner #book-btn { grid-area: button; }

@media (max-width: 768px) {
  .booking-inner { grid-template-columns: 1fr 1fr; grid-template-areas:
      'date time'
      'tickets tours'
      'summary summary'
      'audio button'; }
}
.booking-inner .pill { border: 1px solid #e6e6e6; border-radius: 999px; padding: 8px 12px; background: #fff; min-height: 40px; display: flex; align-items: center; }
.booking-inner .cta { background: var(--accent); color: #fff; padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; }
.booking-inner .cta:disabled { filter: grayscale(1); opacity: .6; cursor: not-allowed; }
/* Booking summary list */
.summary-list { font-size: 14px; color: #2b3a4a; border-top: 1px solid #edf0f3; padding-top: 8px; display: grid; gap: 6px; }
.summary-item { display:flex; align-items:center; justify-content:space-between; }
.summary-item .label { font-weight: 700; }
.summary-item .value { font-weight: 700; color: #22313f; }
/* Calendar compact tweaks */
.calendar { gap: 4px; }
.calendar-head { margin: 2px 0 6px; }
.calendar-block { padding: 8px; }
.calendar .day { aspect-ratio: 4 / 3; font-size: 14px; }
.calendar .day.header { padding: 0; font-size: 12px; }
</style>
</head>
<body>

<header>
	<div class="container nav">
		<div class="brand">Kunsthistorisches Museum Vienna</div>
		<nav>
			<a href="file:///C:/Users/yuanhuaqing/website/Kunsthistorisches%20Museum%20Vienna.html#hours">Hours</a>
			<a href="file:///C:/Users/yuanhuaqing/website/Kunsthistorisches%20Museum%20Vienna.html#tickets">Tickets</a>
			<a href="file:///C:/Users/yuanhuaqing/website/Kunsthistorisches%20Museum%20Vienna.html#tour">Tour Guide</a>
		</nav>
	</div>
</header>

<section class="cover" aria-label="Top image">
	<div class="container cover-inner">
		<img src="./Kunsthistorisches Museum Vienna _ Tickets &amp; Booking_files/cover.jpg" alt="Kunsthistorisches Museum Vienna">
		<div class="overlay">
			<div class="content">
				<h1 class="title">Kunsthistorisches Museum Vienna</h1>
				<p class="subtitle">Ticket Booking</p>
				<p class="address-line" style="margin-top:8px; opacity:.95; font-size:14px;">Maria-Theresien-Platz, 1010 Wien, Austria</p>
			</div>
		</div>
	</div>
</section>

<main class="container">
	<section id="hours" style="border-bottom:0;">
		<h2 class="heading-accent center">Opening Hours</h2>
		<div class="grid">
			<div class="col-12">
				<div class="hours-card">
					<div class="hours-flex">
						<div class="hour-box">
							<h4>Tuesday – Sunday</h4>
							<p>10:00 a.m. – 6:00 p.m.</p>
						</div>
						<div class="hour-box em">
							<h4>Thursday &amp; Public Holidays</h4>
							<p>10:00 a.m. – 9:00 p.m. <span class="hours-em">open late</span></p>
						</div>
						<div class="hour-box">
							<h4>Notes</h4>
							<p>Closed on Monday</p>
						</div>
					</div>
					<p class="hours-note">Time slots are released every 30 minutes.</p>
				</div>
			</div>
			<!-- Address moved to cover; right column removed as requested -->
		</div>
	</section>

	<section id="visit" style="border-bottom:0;">
		<h2 class="heading-accent center">Select Your Visit</h2>
		<div class="grid">
			<div class="col-6">
                    <div class="section-card fill">
                    <h3 class="subheading">Choose Date &amp; Time</h3>
                    <div class="calendar-block">
                        <div class="calendar-head"><button id="cal-prev" class="cal-btn" aria-label="Previous month" disabled="">‹</button><span id="calendar-month-label">2026年8月</span><button id="cal-next" class="cal-btn" aria-label="Next month" disabled="">›</button></div>
                        <div class="calendar" id="calendar-grid" aria-label="August 2026 calendar"><div class="day header">Sun</div><div class="day header">Mon</div><div class="day header">Tue</div><div class="day header">Wed</div><div class="day header">Thu</div><div class="day header">Fri</div><div class="day header">Sat</div><div class="day disabled"></div><div class="day disabled"></div><div class="day disabled"></div><div class="day disabled"></div><div class="day disabled"></div><div class="day disabled"></div><div class="day" role="button" aria-label="August 1, 2026" data-day="1">1</div><div class="day" role="button" aria-label="August 2, 2026" data-day="2">2</div><div class="day disabled" role="button" aria-label="August 3, 2026" data-day="3" title="Closed (Monday)">3</div><div class="day" role="button" aria-label="August 4, 2026" data-day="4">4</div><div class="day" role="button" aria-label="August 5, 2026" data-day="5">5</div><div class="day" role="button" aria-label="August 6, 2026" data-day="6">6</div><div class="day" role="button" aria-label="August 7, 2026" data-day="7">7</div><div class="day" role="button" aria-label="August 8, 2026" data-day="8">8</div><div class="day" role="button" aria-label="August 9, 2026" data-day="9">9</div><div class="day disabled" role="button" aria-label="August 10, 2026" data-day="10" title="Closed (Monday)">10</div><div class="day" role="button" aria-label="August 11, 2026" data-day="11">11</div><div class="day" role="button" aria-label="August 12, 2026" data-day="12">12</div><div class="day" role="button" aria-label="August 13, 2026" data-day="13">13</div><div class="day" role="button" aria-label="August 14, 2026" data-day="14">14</div><div class="day" role="button" aria-label="August 15, 2026" data-day="15">15</div><div class="day" role="button" aria-label="August 16, 2026" data-day="16">16</div><div class="day disabled" role="button" aria-label="August 17, 2026" data-day="17" title="Closed (Monday)">17</div><div class="day" role="button" aria-label="August 18, 2026" data-day="18">18</div><div class="day" role="button" aria-label="August 19, 2026" data-day="19">19</div><div class="day" role="button" aria-label="August 20, 2026" data-day="20">20</div><div class="day" role="button" aria-label="August 21, 2026" data-day="21">21</div><div class="day" role="button" aria-label="August 22, 2026" data-day="22">22</div><div class="day" role="button" aria-label="August 23, 2026" data-day="23">23</div><div class="day disabled" role="button" aria-label="August 24, 2026" data-day="24" title="Closed (Monday)">24</div><div class="day" role="button" aria-label="August 25, 2026" data-day="25">25</div><div class="day" role="button" aria-label="August 26, 2026" data-day="26">26</div><div class="day" role="button" aria-label="August 27, 2026" data-day="27">27</div><div class="day" role="button" aria-label="August 28, 2026" data-day="28">28</div><div class="day" role="button" aria-label="August 29, 2026" data-day="29">29</div><div class="day" role="button" aria-label="August 30, 2026" data-day="30">30</div><div class="day disabled" role="button" aria-label="August 31, 2026" data-day="31" title="Closed (Monday)">31</div></div>
                    </div>
					<div style="height:12px"></div>
					<div id="slots" class="slots" aria-live="polite"></div>
					<p id="closed-note" class="muted" style="display:none;">Closed</p>
				</div>
			</div>
			<div class="col-6">
                    <div class="section-card fill">
                        <h3 class="subheading">Select Tickets</h3>
                        <div class="section-note small"><span class="info-ic lg">⏰</span><span>Important: Please arrive 15 minutes before your selected time.</span></div>
                        <div class="ticket-list with-topline" role="list">
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Full price</strong></div>
                                <div class="ticket-price price-green">€21.00</div>
                                <button class="circle-btn minus" data-minus="full" aria-label="Decrease adults" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="full">0</div>
                                <button class="circle-btn plus" data-plus="full" aria-label="Increase adults">+</button>
                                <input id="qty-full" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Senior citizen</strong><div class="ticket-subtitle"><span class="info-ic">!</span>senior citizens over 65 or on presentation of a valid pensioners' ID</div></div>
                                <div class="ticket-price price-green">€18.00</div>
                                <button class="circle-btn minus" data-minus="senior" aria-label="Decrease seniors" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="senior">0</div>
                                <button class="circle-btn plus" data-plus="senior" aria-label="Increase seniors">+</button>
                                <input id="qty-senior" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Student</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Valid for students up to age 25 on presentation of a valid student ID</div></div>
                                <div class="ticket-price price-green">€18.00</div>
                                <button class="circle-btn minus" data-minus="student" aria-label="Decrease students" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="student">0</div>
                                <button class="circle-btn plus" data-plus="student" aria-label="Increase students">+</button>
                                <input id="qty-student" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Discount</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Valid for challenged people and their escorts</div></div>
                                <div class="ticket-price price-green">€18.00</div>
                                <button class="circle-btn minus" data-minus="discount" aria-label="Decrease discount" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="discount">0</div>
                                <button class="circle-btn plus" data-plus="discount" aria-label="Increase discount">+</button>
                                <input id="qty-discount" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Kids / Teens under 19</strong></div>
                                <div class="ticket-price price-free">FREE</div>
                                <button class="circle-btn minus" data-minus="child" aria-label="Decrease children" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="child">0</div>
                                <button class="circle-btn plus" data-plus="child" aria-label="Increase children">+</button>
                                <input id="qty-child" value="0" readonly="" hidden="">
                            </div>
                        </div>
                        <p class="muted" id="breakdown"></p>
                    </div>
                </div>
		</div>
	</section>

	<section id="tour">
		<h2 class="heading-accent center">Tour Guide &amp; Audio Guide</h2>
		<div class="section-note"><span class="info-ic lg">!</span><span>Notes: Entrance fee not included. Book at least 2–3 weeks in advance.</span></div>
		<div class="grid">
            <div class="col-7">
                <div class="section-card fill">
                    <h3 class="subheading">Private guided tour</h3>
                    <div class="panel-divider"></div>
                    <div class="ticket-list" role="list">
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="adult60">
                                <div class="ticket-title"><strong>Adults (max 25)</strong><div class="ticket-subtitle">approx. <span class="time-pill">⏱ 60 min</span> <span class="remain-pill" data-remain-for="tour_adult60">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€90.00</div>
                                <button class="circle-btn minus" data-minus="tour_adult60" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_adult60">0</div>
                                <button class="circle-btn plus" data-plus="tour_adult60" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-adult60" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="adult90">
                                <div class="ticket-title"><strong>Adults (max 25)</strong><div class="ticket-subtitle">approx. <span class="time-pill">⏱ 90 min</span> <span class="remain-pill" data-remain-for="tour_adult90">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€135.00</div>
                                <button class="circle-btn minus" data-minus="tour_adult90" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_adult90">0</div>
                                <button class="circle-btn plus" data-plus="tour_adult90" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-adult90" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="adult60thu">
                                <div class="ticket-title"><strong>Adults (max 25)</strong><div class="ticket-subtitle">Thu 6–9 p.m., <span class="time-pill">⏱ 60 min</span> <span class="remain-pill" data-remain-for="tour_adult60thu">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€125.00</div>
                                <button class="circle-btn minus" data-minus="tour_adult60thu" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_adult60thu">0</div>
                                <button class="circle-btn plus" data-plus="tour_adult60thu" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-adult60thu" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="adult90thu">
                                <div class="ticket-title"><strong>Adults (max 25)</strong><div class="ticket-subtitle">Thu 6–9 p.m., <span class="time-pill">⏱ 90 min</span> <span class="remain-pill" data-remain-for="tour_adult90thu">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€187.50</div>
                                <button class="circle-btn minus" data-minus="tour_adult90thu" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_adult90thu">0</div>
                                <button class="circle-btn plus" data-plus="tour_adult90thu" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-adult90thu" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="family50">
                                <div class="ticket-title"><strong>Children &amp; families (max 13)</strong><div class="ticket-subtitle">approx. <span class="time-pill">⏱ 50 min</span> <span class="remain-pill" data-remain-for="tour_family50">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€40.00</div>
                                <button class="circle-btn minus" data-minus="tour_family50" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_family50">0</div>
                                <button class="circle-btn plus" data-plus="tour_family50" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-family50" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="family90">
                                <div class="ticket-title"><strong>Children &amp; families (max 13)</strong><div class="ticket-subtitle">approx. <span class="time-pill">⏱ 90 min</span> <span class="remain-pill" data-remain-for="tour_family90">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€60.00</div>
                                <button class="circle-btn minus" data-minus="tour_family90" aria-label="Decrease tour people" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="tour_family90">0</div>
                                <button class="circle-btn plus" data-plus="tour_family90" aria-label="Increase tour people">+</button>
                                <input id="qty-tour-family90" value="0" readonly="" hidden="">
                            </div>
                    </div>
                    <div style="display:flex; justify-content:flex-end; align-items:center; margin-top:12px;">
                        <p class="muted" id="tour-price-note" style="margin: 0px; display: none;"></p>
                    </div>
                </div>
            </div>
            <div class="col-5">
                <div class="section-card fill">
                    <h3 class="subheading">Audio Guides</h3>
                    <div class="panel-divider"></div>
                    <div class="section-note small"><span class="info-ic lg">🌐</span><span>Audio guides available in: German, English, Italian, French, Spanish, Ukrainian, Russian, Korean, Japanese and Mandarin.</span></div>
                    <div class="ticket-list" role="list">
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide</strong></div>
                                <div class="ticket-price price-green">€6.00</div>
                                <button class="circle-btn minus" data-minus="ag6" aria-label="Decrease audio guide" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="ag6">0</div>
                                <button class="circle-btn plus" data-plus="ag6" aria-label="Increase audio guide">+</button>
                                <input id="qty-ag6" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide “Take 2”</strong></div>
                                <div class="ticket-price price-green">€8.00</div>
                                <button class="circle-btn minus" data-minus="ag8" aria-label="Decrease take 2" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="ag8">0</div>
                                <button class="circle-btn plus" data-plus="ag8" aria-label="Increase take 2">+</button>
                                <input id="qty-ag8" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide Family</strong><div class="ticket-subtitle"><span class="info-ic">!</span>2 adults and up to 3 children</div></div>
                                <div class="ticket-price price-green">€9.00</div>
                                <button class="circle-btn minus" data-minus="ag9" aria-label="Decrease family guide" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="ag9">0</div>
                                <button class="circle-btn plus" data-plus="ag9" aria-label="Increase family guide">+</button>
                                <input id="qty-ag9" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide Group (10+)</strong><div class="ticket-subtitle"><span class="info-ic">!</span>per person (groups of 10 or more)</div></div>
                                <div class="ticket-price price-green">€4.00</div>
                                <button class="circle-btn minus" data-minus="ag4" aria-label="Decrease group guide" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="ag4">0</div>
                                <button class="circle-btn plus" data-plus="ag4" aria-label="Increase group guide">+</button>
                                <input id="qty-ag4" value="0" readonly="" hidden="">
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide (Annual pass)</strong></div>
                                <div class="ticket-price price-green">€3.00</div>
                                <button class="circle-btn minus" data-minus="ag3" aria-label="Decrease annual pass guide" disabled="">−</button>
                                <div class="ticket-qty" data-qty-num="ag3">0</div>
                                <button class="circle-btn plus" data-plus="ag3" aria-label="Increase annual pass guide">+</button>
                                <input id="qty-ag3" value="0" readonly="" hidden="">
                            </div>
                    </div>
                </div>
            </div>
		</div>
	</section>
</main>


<div class="booking-bar">
	<div class="container booking-inner">
		<div class="pill" id="pill-date">Date: <span style="margin-left:6px;" id="pill-date-text">Select</span></div>
		<div class="pill" id="pill-time">Time: <span style="margin-left:6px;" id="pill-time-text">Select</span></div>
		<div class="pill" id="pill-count">Tickets: <span style="margin-left:6px;" id="pill-count-text">0 (€0.00)</span></div>
		<div class="pill" id="pill-tours">Private guided tour: <span style="margin-left:6px;" id="pill-tours-text">0 (€0.00)</span></div>
		<div class="pill" id="pill-audio">Audio Guides: <span style="margin-left:6px;" id="pill-audio-text">0 (€0.00)</span></div>
		<div id="summary" class="summary-list" aria-live="polite" style="display: none;"></div>
	</div>
</div>

<section class="final-summary">
	<div class="container">
		<div class="final-dt">Date: <span id="final-date-text">Select</span> <span class="sep">•</span> Time: <span id="final-time-text">Select</span></div>
		<div class="final-divider"></div>
		<div id="final-breakdown" class="final-list" aria-live="polite" style="display: none;"></div>
		<div class="total-banner">Total: <span id="final-total-text">€0.00</span></div>
		<div id="success-message" class="success-banner">Successfully</div>
		<button id="book-btn" class="final-cta" disabled="">BOOK NOW</button>
	</div>
</section>


<footer>
	<div class="container">
		<p class="muted">© <span id="year">2025</span> Kunsthistorisches Museum Vienna (Unofficial Demo)</p>
	</div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

// Constants
const ATTRACTION_NAME = 'Kunsthistorisches Museum Vienna';
const CAL_YEAR = 2026;
const CAL_MONTH = 7; // August (0-based)
const PRICES = { full: 21, senior: 18, student: 18, discount: 18, child: 0 };
const TICKET_LABELS = { full: 'Full price', senior: 'Senior citizen', student: 'Student', discount: 'Discount', child: 'Kids / Teens under 19' };
const TOUR_OPTIONS = {
	adult60: { label:'Adults 60', price:90, max:25 },
	adult90: { label:'Adults 90', price:135, max:25 },
	adult60thu: { label:'Adults 60 Thu', price:125, max:25 },
	adult90thu: { label:'Adults 90 Thu', price:187.5, max:25 },
	family50: { label:'Family 50', price:40, max:13 },
	family90: { label:'Family 90', price:60, max:13 }
};
const AUDIO_GUIDE_PRICES = { ag6: 6, ag8: 8, ag9: 9, ag4: 4, ag3: 3 };
const AUDIO_LABELS = { ag6: 'Audio Guide', ag8: 'Audio Guide “Take 2”', ag9: 'Audio Guide Family', ag4: 'Audio Guide Group (10+)', ag3: 'Audio Guide (Annual pass)' };

// Elements
const calendarGrid = document.getElementById('calendar-grid');
const calendarMonthLabel = document.getElementById('calendar-month-label');
const calPrev = document.getElementById('cal-prev');
const calNext = document.getElementById('cal-next');
const MONTH_NAMES = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const MONTH_ABBR = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
let viewYear = CAL_YEAR;
let viewMonth = CAL_MONTH; // 0-based

// Lock navigation to August only (buttons present but disabled)
if (calPrev) calPrev.disabled = true;
if (calNext) calNext.disabled = true;
const slotsWrap = document.getElementById('slots');
const closedNote = document.getElementById('closed-note');
const bookBtn = document.getElementById('book-btn');
const pillDateText = document.getElementById('pill-date-text');
const pillTimeText = document.getElementById('pill-time-text');
const finalDateText = document.getElementById('final-date-text');
const finalTimeText = document.getElementById('final-time-text');
const pillCountText = document.getElementById('pill-count-text');
const pillToursText = document.getElementById('pill-tours-text');
const pillAudioText = document.getElementById('pill-audio-text');
const summaryEl = document.getElementById('summary');
const finalBreakdownEl = document.getElementById('final-breakdown');
const totalEl = document.getElementById('total');
const breakdownEl = document.getElementById('breakdown');
const finalTotalText = document.getElementById('final-total-text');
// total pill removed; keep logic via lastTotal if needed

const qtyInputs = {
	full: document.getElementById('qty-full'),
	senior: document.getElementById('qty-senior'),
	student: document.getElementById('qty-student'),
	discount: document.getElementById('qty-discount'),
	child: document.getElementById('qty-child'),
	// Tour options (multi-select quantities)
	tour_adult60: document.getElementById('qty-tour-adult60'),
	tour_adult90: document.getElementById('qty-tour-adult90'),
	tour_adult60thu: document.getElementById('qty-tour-adult60thu'),
	tour_adult90thu: document.getElementById('qty-tour-adult90thu'),
	tour_family50: document.getElementById('qty-tour-family50'),
	tour_family90: document.getElementById('qty-tour-family90'),
	ag6: document.getElementById('qty-ag6'),
	ag8: document.getElementById('qty-ag8'),
	ag9: document.getElementById('qty-ag9'),
	ag4: document.getElementById('qty-ag4'),
	ag3: document.getElementById('qty-ag3')
};

// Tour selectors (checkboxes now, allow multi-select)
const tourOptionRadios = () => Array.from(document.querySelectorAll('input[name="tour-option"]'));
const tourPriceNote = document.getElementById('tour-price-note');

let selectedDate = null; // { day, weekday }
let selectedTime = null; // 'HH:MM'
let tourRemainingByKey = {}; // per tour option remaining cache
let lastTotal = 0; // cached total value

function pad(n){ return String(n).padStart(2,'0'); }

function weekdayOf(y,m,d){ return new Date(y,m,d).getDay(); } // 0 Sun ... 6 Sat

function isPublicHoliday(y,m,d){
	// Placeholder — for demo, assume no special public holidays beyond rules
	return false;
}

function isClosedWeekday(weekday){
	// Closed on Mondays (1 = Monday? In JS, 1 is Monday? No: 1 = Monday when starting Monday, but JS 1 = Monday? Actually JS: 0 Sun, 1 Mon)
	return weekday === 1; // Monday
}

function buildCalendar(){
    if (calendarMonthLabel) {
        calendarMonthLabel.textContent = `${viewYear}年${viewMonth + 1}月`;
    }
    calendarGrid.setAttribute('aria-label', `${MONTH_NAMES[viewMonth]} ${viewYear} calendar`);
    calendarGrid.innerHTML = '';
    const first = new Date(viewYear, viewMonth, 1);
    const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
	// Render weekday headers for variety in style
	const headers = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    for (const h of headers){
        const hd = document.createElement('div');
        hd.className = 'day header';
        hd.textContent = h;
        calendarGrid.appendChild(hd);
    }
	// Fill leading blanks from Sunday
    const startDow = first.getDay();
	for (let i=0;i<startDow;i++){
		const blank = document.createElement('div');
		blank.className = 'day disabled';
		blank.textContent = '';
		calendarGrid.appendChild(blank);
	}
	for (let d=1; d<=daysInMonth; d++){
        const dow = weekdayOf(viewYear, viewMonth, d);
		const cell = document.createElement('div');
		cell.className = 'day';
		cell.setAttribute('role','button');
		cell.setAttribute('aria-label', `August ${d}, ${CAL_YEAR}`);
		cell.textContent = String(d);
		cell.dataset.day = String(d);
		if (isClosedWeekday(dow)){
			cell.classList.add('disabled');
			cell.title = 'Closed (Monday)';
		} else {
            cell.addEventListener('click', ()=> selectDate(d));
        }
        calendarGrid.appendChild(cell);
    }
}

function selectDate(day){
    selectedDate = { year: viewYear, month: viewMonth, day, weekday: weekdayOf(viewYear, viewMonth, day) };
    selectedTime = null;
    [...calendarGrid.querySelectorAll('.day')].forEach(el=> el.classList.remove('selected'));
    const target = calendarGrid.querySelector(`.day[data-day="${day}"]`);
    if (target) target.classList.add('selected');
    pillDateText.textContent = `${MONTH_ABBR[viewMonth]} ${day}`;
    pillTimeText.textContent = 'Select';
    if (finalDateText) finalDateText.textContent = `${viewYear}-${pad(viewMonth+1)}-${pad(day)}`;
    if (finalTimeText) finalTimeText.textContent = 'Select';
    buildSlotsForDay(day);
    enableOrDisableBook();
}

function buildSlotsForDay(day){
    slotsWrap.innerHTML = '';
    const dow = weekdayOf(viewYear, viewMonth, day);
    const closed = isClosedWeekday(dow);
    const holiday = isPublicHoliday(viewYear, viewMonth, day);
    if (closed){
        closedNote.style.display = '';
        return;
    }
	closedNote.style.display = 'none';
	// Opening window
	const openHour = 10;
	const closeHour = holiday || dow === 4 ? 21 : 18; // Thu=4 → 21:00
	const slots = [];
	for (let h=openHour; h<closeHour; h++){
		for (let m of [0,30]){
			slots.push(`${pad(h)}:${pad(m)}`);
		}
	}
	// Render
	slots.forEach(time=>{
		const wrap = document.createElement('div');
		wrap.className = 'slot-wrap';
		const s = document.createElement('button');
		s.type = 'button';
		s.className = 'slot';
		s.textContent = time;
		const sold = Math.random() < 0.1;
		if (sold){
			s.classList.add('disabled');
			s.disabled = true;
			const tag = document.createElement('span');
			tag.className = 'soldout';
			tag.textContent = 'Sold Out';
			wrap.appendChild(tag);
		}
        s.addEventListener('click', ()=>{
            selectedTime = time;
            [...slotsWrap.children].forEach(c=> c.querySelector('.slot')?.classList.remove('selected'));
            s.classList.add('selected');
            pillTimeText.textContent = time;
            if (finalTimeText) finalTimeText.textContent = time;
            enableOrDisableBook();
            tourRemainingByKey = {}; // reset remaining cache per new timeslot
            updateTourPriceNote();
            refreshTourRemainingUI();
        });
		wrap.appendChild(s);
		slotsWrap.appendChild(wrap);
	});
}

function updateTotals(){
    let total = 0;
    const parts = [];
    // Standard tickets
    let ticketCount = 0; let ticketTotal = 0;
    for (const key of ['full','senior','student','discount','child']){
        const qty = parseInt(qtyInputs[key].value||'0',10);
        if (!qty) continue;
        const price = PRICES[key];
        total += qty * price;
        ticketCount += qty;
        ticketTotal += qty * price;
        const label = key === 'full' ? 'Full' : key.charAt(0).toUpperCase()+key.slice(1);
        parts.push(`${qty} × €${price.toFixed(2)} (${label})`);
    }
    // Tour guide (multi-select)
    let tourCount = 0; let tourTotal = 0;
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const people = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!people) continue;
        const opt = TOUR_OPTIONS[optKey];
        total += people * opt.price;
        tourCount += people;
        tourTotal += people * opt.price;
        parts.push(`${people} × €${opt.price.toFixed(2)} (Tour ${opt.label})`);
    }
    // Audio guides
    let audioCount = 0; let audioTotal = 0;
    for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
        const q = parseInt(qtyInputs[ag].value||'0',10);
        if (!q) continue;
        const price = AUDIO_GUIDE_PRICES[ag];
        total += q * price;
        audioCount += q;
        audioTotal += q * price;
        parts.push(`${q} × €${price.toFixed(2)} (${ag.toUpperCase()})`);
    }
    lastTotal = total;
    if (totalEl) totalEl.textContent = `Total: €${total.toFixed(2)}`;
    if (breakdownEl) breakdownEl.textContent = parts.join(' + ');
    // Update final bottom total banner
    if (finalTotalText) finalTotalText.textContent = `€${total.toFixed(2)}`;
    // total pill removed from footer; total stays in lastTotal
    pillCountText.textContent = `${ticketCount} (€${ticketTotal.toFixed(2)})`;
    if (pillToursText) pillToursText.textContent = `${tourCount} (€${tourTotal.toFixed(2)})`;
    if (pillAudioText) pillAudioText.textContent = `${audioCount} (€${audioTotal.toFixed(2)})`;
    // Render compact summary lines (only show purchased categories)
    if (summaryEl){
        const lines = [];
        if (ticketCount > 0){
            const val = ticketTotal > 0 ? `€${ticketTotal.toFixed(2)}` : 'Free';
            lines.push(`<div class="summary-item"><span class="label">Tickets (${ticketCount})</span><span class="value">${val}</span></div>`);
        }
        if (tourCount > 0){
            lines.push(`<div class="summary-item"><span class="label">Private guided tour (${tourCount})</span><span class="value">€${tourTotal.toFixed(2)}</span></div>`);
        }
        if (audioCount > 0){
            lines.push(`<div class="summary-item"><span class="label">Audio Guides (${audioCount})</span><span class="value">€${audioTotal.toFixed(2)}</span></div>`);
        }
        summaryEl.innerHTML = lines.join('');
        summaryEl.style.display = lines.length ? '' : 'none';
    }
    // Sync visible quantities and button disabled states for ticket rows
    for (const key of ['full','senior','student','discount','child']){
        const val = parseInt(qtyInputs[key].value||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${key}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${key}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    // Audio guides numbers and minus state
    for (const key of ['ag6','ag8','ag9','ag4','ag3']){
        const val = parseInt(qtyInputs[key].value||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${key}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${key}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    // Tour per-option qty sync and controls enablement
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const val = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${qtyKey}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${qtyKey}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    refreshTourRemainingUI();

    // Render detailed final breakdown (each purchased ticket type)
    if (finalBreakdownEl){
        const items = [];
        // Standard tickets by type
        for (const key of ['full','senior','student','discount','child']){
            const qty = parseInt(qtyInputs[key].value||'0',10);
            if (!qty) continue;
            const price = PRICES[key];
            const val = price > 0 ? `€${(qty*price).toFixed(2)}` : 'Free';
            items.push(`<div class=\"final-item\"><span class=\"label\">${TICKET_LABELS[key]} (${qty})</span><span class=\"value\">${val}</span></div>`);
        }
        // Tour options by type
        for (const optKey of Object.keys(TOUR_OPTIONS)){
            const qtyKey = `tour_${optKey}`;
            const people = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
            if (!people) continue;
            const opt = TOUR_OPTIONS[optKey];
            items.push(`<div class=\"final-item\"><span class=\"label\">Private guided tour — ${opt.label} (${people})</span><span class=\"value\">€${(people*opt.price).toFixed(2)}</span></div>`);
        }
        // Audio guides by type
        for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
            const q = parseInt(qtyInputs[ag].value||'0',10);
            if (!q) continue;
            const price = AUDIO_GUIDE_PRICES[ag];
            items.push(`<div class=\"final-item\"><span class=\"label\">${AUDIO_LABELS[ag]} (${q})</span><span class=\"value\">€${(q*price).toFixed(2)}</span></div>`);
        }
        finalBreakdownEl.innerHTML = items.join('');
        finalBreakdownEl.style.display = items.length ? '' : 'none';
    }

    enableOrDisableBook();
}

function attachQtyHandlers(){
    document.querySelectorAll('[data-plus]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            const k = btn.getAttribute('data-plus');
            if (k && k.startsWith('tour_')){
                const optKey = k.replace('tour_','');
                const opt = TOUR_OPTIONS[optKey];
                const cur = parseInt(qtyInputs[k].value||'0',10);
                const next = Math.min(cur+1, opt.max);
                qtyInputs[k].value = String(next);
                // Ensure its checkbox is checked
                const row = btn.closest('.ticket-row');
                const cb = row?.querySelector('input[name="tour-option"]');
                if (cb) cb.checked = parseInt(qtyInputs[k].value,10) > 0;
            } else {
                qtyInputs[k].value = String(parseInt(qtyInputs[k].value,10)+1);
            }
            updateTotals();
        });
    });
    document.querySelectorAll('[data-minus]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            const k = btn.getAttribute('data-minus');
            if (k && k.startsWith('tour_')){
                const optKey = k.replace('tour_','');
                const cur = parseInt(qtyInputs[k].value||'0',10);
                const next = Math.max(0, cur-1);
                qtyInputs[k].value = String(next);
                const row = btn.closest('.ticket-row');
                const cb = row?.querySelector('input[name="tour-option"]');
                if (cb) cb.checked = next > 0;
            } else {
                const cur = parseInt(qtyInputs[k].value,10);
                qtyInputs[k].value = String(Math.max(0, cur-1));
            }
            updateTotals();
        });
    });
}

function randomRemaining(max){
	const min = Math.ceil(max*0.3);
	const rem = Math.floor(Math.random()*(max-min+1))+min;
	return Math.max(0, Math.min(max, rem));
}

let currentRemaining = null;

function updateTourPriceNote(){
    // Aggregate note for multi-select tours
    const picks = [];
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const n = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!n) continue;
        const opt = TOUR_OPTIONS[optKey];
        picks.push(`${opt.label}: ${n} × €${opt.price.toFixed(2)}`);
    }
    if (picks.length) {
        tourPriceNote.style.display = '';
        tourPriceNote.textContent = `Tours: ${picks.join(' • ')}`;
    } else {
        tourPriceNote.textContent = '';
        tourPriceNote.style.display = 'none';
    }
}

function getOrComputeTourRemaining(optKey){
    if (tourRemainingByKey[optKey] != null) return tourRemainingByKey[optKey];
    const opt = TOUR_OPTIONS[optKey];
    const rem = computeRemainingFromTime(opt.max);
    tourRemainingByKey[optKey] = rem;
    return rem;
}

function refreshTourRemainingUI(){
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const el = document.querySelector(`[data-remain-for="tour_${optKey}"]`);
        if (!el) continue;
        // Show remaining only when the checkbox is checked; otherwise show dash
        const cb = document.querySelector(`.ticket-row.tour input[name="tour-option"][value="${optKey}"]`);
        if (cb && cb.checked){
            el.textContent = `Remaining: ${getOrComputeTourRemaining(optKey)}`;
        } else {
            el.textContent = 'Remaining: —';
        }
    }
}

function computeRemainingFromTime(max){
	if (!selectedTime){ return randomRemaining(max); }
	const parts = selectedTime.split(':');
	const h = parseInt(parts[0],10);
	let desirability = 0; // 0 low, 0.5 medium, 1 peak
	if (h>=11 && h<15) desirability = 1; // midday peak
	if (selectedDate && selectedDate.weekday === 4 && h>=18 && h<21) desirability = 1; // Thu evening peak
	if (!desirability && ((h>=10 && h<11) || (h>=15 && h<18))) desirability = 0.5; // shoulder
	let minFrac, maxFrac;
	if (desirability === 1){ minFrac = 0.05; maxFrac = 0.35; }
	else if (desirability === 0.5){ minFrac = 0.2; maxFrac = 0.6; }
	else { minFrac = 0.4; maxFrac = 0.9; }
	const min = Math.max(1, Math.floor(max*minFrac));
	const maxN = Math.max(min, Math.floor(max*maxFrac));
	return Math.floor(Math.random()*(maxN-min+1)) + min;
}

function enableOrDisableBook(){
	const anyQty = Object.values(qtyInputs).some(i=> parseInt(i.value||'0',10) > 0);
	bookBtn.disabled = !(selectedDate && selectedTime && anyQty);
}

function buildApiParams(){
	if (!selectedDate) return null;
	return [ATTRACTION_NAME, `8.${selectedDate.day}`];
}

bookBtn.addEventListener('click', ()=>{
	const params = buildApiParams();
	const payload = {
		params,
        date: `${selectedDate.year}-${pad(selectedDate.month + 1)}-${pad(selectedDate.day)}`,
		time: selectedTime,
		quantities: Object.fromEntries(Object.entries(qtyInputs).map(([k,i])=>[k, parseInt(i.value||'0',10)])),
		tourSelection: (()=>{
			const r = tourOptionRadios().find(x=>x.checked);
			if (!r) return null;
			const opt = TOUR_OPTIONS[r.value];
			return { optionKey: r.value, label: opt.label, pricePerPerson: opt.price, remainingAtSelection: currentRemaining };
		})(),
        total: lastTotal.toFixed(2)
	};
    console.log('Booking payload', payload);
    try {
        alert(`Booking successfully!\nDate: ${payload.date}\nTime: ${payload.time}\nTotal: €${lastTotal.toFixed(2)}`);
    } catch (e) {
        // no-op in environments without alert
    }
    const successEl = document.getElementById('success-message');
    if (successEl){
        successEl.style.display = '';
        successEl.textContent = 'Successfully';
        successEl.setAttribute('role','status');
    }
    document.querySelector('.final-summary')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
});

// Init
buildCalendar();
attachQtyHandlers();
updateTotals();
updateTourPriceNote();
tourOptionRadios().forEach(r=> r.addEventListener('change', ()=>{ updateTourPriceNote(); refreshTourRemainingUI(); updateTotals(); }));

// Navigate to success page with confirmation details
bookBtn.addEventListener('click', ()=>{
    // Build modal data
    const dateStr = selectedDate ? `${selectedDate.year}-${pad(selectedDate.month + 1)}-${pad(selectedDate.day)}` : '';
    const timeStr = selectedTime || '';
    const lines = [];
    for (const key of ['full','senior','student','discount','child']){
        const qty = parseInt(qtyInputs[key].value||'0',10);
        if (!qty) continue;
        const price = PRICES[key];
        lines.push({ label: TICKET_LABELS[key], qty, total: +(qty*price).toFixed(2), free: price===0 });
    }
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const qty = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!qty) continue;
        const opt = TOUR_OPTIONS[optKey];
        lines.push({ label: `Private guided tour — ${opt.label}`, qty, total: +(qty*opt.price).toFixed(2), free: false });
    }
    for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
        const qty = parseInt(qtyInputs[ag].value||'0',10);
        if (!qty) continue;
        const price = AUDIO_GUIDE_PRICES[ag];
        lines.push({ label: AUDIO_LABELS[ag], qty, total: +(qty*price).toFixed(2), free: price===0 });
    }
    const modal = document.getElementById('book-modal');
    if (!modal) return; // modal removed (reverted)
    const ml = document.getElementById('modal-lines');
    document.getElementById('modal-date').textContent = dateStr || '—';
    document.getElementById('modal-time').textContent = timeStr || '—';
    document.getElementById('modal-total').textContent = `€${lastTotal.toFixed(2)}`;
    ml.innerHTML = lines.map(li=> `<div class="item"><span class="label">${li.label} (${li.qty})</span><span class="value">${li.free ? 'Free' : ('€'+li.total.toFixed(2))}</span></div>`).join('');
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
});

// Close modal handlers
document.getElementById('modal-close')?.addEventListener('click', ()=>{
    const modal = document.getElementById('book-modal');
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
});
document.getElementById('book-modal')?.addEventListener('click', (e)=>{
    if (e.target.id === 'book-modal'){
        const modal = document.getElementById('book-modal');
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
    }
});
document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape'){
        const modal = document.getElementById('book-modal');
        if (modal && modal.style.display !== 'none'){
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden','true');
        }
    }
});
// Month navigation (no page jump)
if (calPrev) calPrev.addEventListener('click', ()=>{
    viewMonth -= 1;
    if (viewMonth < 0) { viewMonth = 11; viewYear -= 1; }
    selectedDate = null; selectedTime = null; pillDateText.textContent = 'Select'; pillTimeText.textContent = 'Select'; currentRemaining = null;
    buildCalendar(); enableOrDisableBook(); updateTourPriceNote();
});
if (calNext) calNext.addEventListener('click', ()=>{
    viewMonth += 1;
    if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
    selectedDate = null; selectedTime = null; pillDateText.textContent = 'Select'; pillTimeText.textContent = 'Select'; currentRemaining = null;
    buildCalendar(); enableOrDisableBook(); updateTourPriceNote();
});
</script>


</body></html>